[gd_scene load_steps=20 format=3 uid="uid://d3y1tgbp7c8lg"]

[ext_resource type="Script" uid="uid://cqt14mrn4aipo" path="res://scripts/game_manager.gd" id="1_lbhrr"]
[ext_resource type="PackedScene" uid="uid://cfvic4a0uhu8y" path="res://scenes/rectangle_piece.tscn" id="3_iywne"]
[ext_resource type="PackedScene" uid="uid://b1jdv6tkoji6m" path="res://scenes/square_piece.tscn" id="3_lbhrr"]
[ext_resource type="Texture2D" uid="uid://c4lokrduwe4nq" path="res://assets/cursor/tilemap.png" id="3_lnu2h"]
[ext_resource type="Texture2D" uid="uid://bki85iqf8uq0t" path="res://icon.svg" id="4_lbhrr"]
[ext_resource type="PackedScene" uid="uid://d0vhsil4b4vdq" path="res://scenes/large_rectangle_piece.tscn" id="4_vtaks"]
[ext_resource type="PackedScene" uid="uid://kiax1iithvls" path="res://scenes/large_square_piece.tscn" id="5_kvpfn"]
[ext_resource type="PackedScene" uid="uid://0pdnbiwkpdcd" path="res://scenes/pause_menu.tscn" id="6_0tnpc"]
[ext_resource type="PackedScene" uid="uid://1td2g0uehjhg" path="res://scenes/t_piece.tscn" id="6_dinhu"]
[ext_resource type="PackedScene" uid="uid://c8hagkofh2git" path="res://scenes/l_piece.tscn" id="7_kvuet"]
[ext_resource type="Script" uid="uid://dyw4mvoa8shpc" path="res://scripts/grab_limit_line.gd" id="7_u5sy4"]
[ext_resource type="FontFile" uid="uid://cqel0vg7huulo" path="res://assets/fonts/SairaCondensed-ExtraLight.ttf" id="8_gee14"]
[ext_resource type="PackedScene" uid="uid://bacujhuoal8n3" path="res://scenes/player_ui.tscn" id="9_kvuet"]
[ext_resource type="PackedScene" uid="uid://cy71q0uelvtaq" path="res://scenes/enemy_ui.tscn" id="10_trtic"]
[ext_resource type="Texture2D" uid="uid://xojy0x0ct6p2" path="res://assets/mad_triangle/evil_triangulus.png" id="11_ir15t"]

[sub_resource type="GDScript" id="GDScript_ir15t"]
script/source = "extends Sprite2D

const SPAWN_POSITIONS = [Vector2(192, 100), Vector2(576, 100), Vector2(1344, 100), Vector2(1728, 100)]

var tween: Tween
signal reached_position(spawn_pos: Vector2)

func move_to_spawn_position():
	var target_pos = SPAWN_POSITIONS[randi_range(0, SPAWN_POSITIONS.size() - 1)]
	
	tween.kill()  # Por si ya hay algo anim√°ndose
	tween.tween_property(self, \"position\", target_pos, 0.5).set_trans(Tween.TRANS_SINE).set_ease(Tween.EASE_IN_OUT)
	
	tween.connect(\"finished\", Callable(self, \"_on_tween_finished\").bind(target_pos), ConnectFlags.CONNECT_ONE_SHOT)

func _on_tween_finished(target_pos: Vector2):
	emit_signal(\"reached_position\", target_pos)
"

[sub_resource type="WorldBoundaryShape2D" id="WorldBoundaryShape2D_e2o6t"]

[sub_resource type="RectangleShape2D" id="RectangleShape2D_iywne"]
size = Vector2(214, 125)

[sub_resource type="WorldBoundaryShape2D" id="WorldBoundaryShape2D_ca42v"]

[node name="Game" type="Node2D"]

[node name="GameManager" type="Node" parent="."]
script = ExtResource("1_lbhrr")
piece_scenes = Array[PackedScene]([ExtResource("3_lbhrr"), ExtResource("3_iywne"), ExtResource("4_vtaks"), ExtResource("5_kvpfn"), ExtResource("6_dinhu"), ExtResource("7_kvuet")])

[node name="MouseCursor" type="Sprite2D" parent="GameManager"]
scale = Vector2(2, 2)
texture = ExtResource("3_lnu2h")
region_enabled = true
region_rect = Rect2(255, 100.681, 16.673, 18.2035)

[node name="PlayerUI" parent="GameManager" instance=ExtResource("9_kvuet")]

[node name="EnemyUI" parent="GameManager" instance=ExtResource("10_trtic")]

[node name="EvilTriangulus" type="Sprite2D" parent="GameManager"]
position = Vector2(960, 68)
scale = Vector2(2.5625, 2.5625)
texture = ExtResource("11_ir15t")
script = SubResource("GDScript_ir15t")

[node name="PauseMenu" parent="." instance=ExtResource("6_0tnpc")]
visible = false

[node name="Pieces" type="Node2D" parent="."]

[node name="Ground" type="StaticBody2D" parent="."]
position = Vector2(960, 1080)
metadata/_edit_group_ = true

[node name="CollisionShape2D" type="CollisionShape2D" parent="Ground"]
shape = SubResource("WorldBoundaryShape2D_e2o6t")

[node name="StaticBody2D" type="StaticBody2D" parent="."]
position = Vector2(960, 1016)
metadata/_edit_group_ = true

[node name="Sprite2D" type="Sprite2D" parent="StaticBody2D"]
scale = Vector2(1.66406, 0.972656)
texture = ExtResource("4_lbhrr")

[node name="CollisionShape2D" type="CollisionShape2D" parent="StaticBody2D"]
shape = SubResource("RectangleShape2D_iywne")

[node name="CanvasLayer" type="CanvasLayer" parent="."]
visible = false

[node name="GrabLimitLine" type="Node2D" parent="CanvasLayer"]
script = ExtResource("7_u5sy4")
font = ExtResource("8_gee14")

[node name="SpawnPieceTimer" type="Timer" parent="."]
wait_time = 4.0

[node name="Delay" type="Timer" parent="."]
wait_time = 0.5

[node name="DamageZone" type="Area2D" parent="."]
position = Vector2(960, 172)
rotation = 3.14159
metadata/_edit_group_ = true

[node name="CollisionShape2D" type="CollisionShape2D" parent="DamageZone"]
shape = SubResource("WorldBoundaryShape2D_ca42v")

[connection signal="timeout" from="SpawnPieceTimer" to="GameManager" method="_on_spawn_piece_timer_timeout"]
[connection signal="body_entered" from="DamageZone" to="GameManager" method="_on_damage_zone_body_entered"]
